stages:
  - test

Install and test:
  script:
    # Install the lsforce package, its dependencies, and testing packages
    - source /etc/profile.d/conda.sh
    - conda config --add channels conda-forge
    - conda create --name lsforce
    - source activate lsforce
    - conda install --yes cartopy=0.20 notebook 'numpy<1.22' obspy pyqt xarray rasterio
    - conda install --yes black isort pytest-cov pytest-mpl
    - pip install --editable .
    # Run tests
    - black --skip-string-normalization --check .
    - isort --conda-env lsforce --check-only .
    - pytest --cov-report html:cov_html
  artifacts:
    paths:
      - cov_html
  stage: test
  image: ${DEVOPS_REGISTRY}usgs/conda:latest
  tags:
    - development
